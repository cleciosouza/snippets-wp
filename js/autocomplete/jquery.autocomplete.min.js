(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a);}else{a(jQuery);}}(function(d){var a=(function(){return{escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");
},createNode:function(e){var f=document.createElement("div");f.innerHTML=e;return f.firstChild;}};}()),c={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};
function b(f,e){var h=function(){},g=this,i={autoSelectFirst:false,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:false,onSearchStart:h,onSearchComplete:h,containerClass:"autocomplete-suggestions",tabDisabled:false,dataType:"text",currentRequest:null,lookupFilter:function(k,j,l){return k.value.toLowerCase().indexOf(l)!==-1;
},paramName:"query",transformResult:function(j){return typeof j==="string"?d.parseJSON(j):j;}};g.element=f;g.el=d(f);g.suggestions=[];g.badQueries=[];g.selectedIndex=-1;
g.currentValue=g.element.value;g.intervalId=0;g.cachedResponse=[];g.onChangeInterval=null;g.onChange=null;g.isLocal=false;g.suggestionsContainer=null;g.options=d.extend({},i,e);
g.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"};g.hint=null;g.hintValue="";g.selection=null;g.initialize();g.setOptions(e);
}b.utils=a;d.Autocomplete=b;b.formatResult=function(e,f){var g="("+a.escapeRegExChars(f)+")";return e.value.replace(new RegExp(g,"gi"),"<strong>$1</strong>");
};b.prototype={killerFn:null,initialize:function(){var h=this,i="."+h.classes.suggestion,g=h.classes.selected,f=h.options,e;h.element.setAttribute("autocomplete","off");
h.killerFn=function(j){if(d(j.target).closest("."+h.options.containerClass).length===0){h.killSuggestions();h.disableKillerFn();}};h.suggestionsContainer=b.utils.createNode('<div class="'+f.containerClass+'" style="position: absolute; display: none;"></div>');
e=d(h.suggestionsContainer);e.appendTo(f.appendTo);if(f.width!=="auto"){e.width(f.width);}e.on("mouseover.autocomplete",i,function(){h.activate(d(this).data("index"));
});e.on("mouseout.autocomplete",function(){h.selectedIndex=-1;e.children("."+g).removeClass(g);});e.on("click.autocomplete",i,function(){h.select(d(this).data("index"));
});h.fixPosition();h.fixPositionCapture=function(){if(h.visible){h.fixPosition();}};d(window).on("resize",h.fixPositionCapture);h.el.on("keydown.autocomplete",function(j){h.onKeyPress(j);
});h.el.on("keyup.autocomplete",function(j){h.onKeyUp(j);});h.el.on("blur.autocomplete",function(){h.onBlur();});h.el.on("focus.autocomplete",function(){h.fixPosition();
});h.el.on("change.autocomplete",function(j){h.onKeyUp(j);});},onBlur:function(){this.enableKillerFn();},setOptions:function(g){var f=this,e=f.options;
d.extend(e,g);f.isLocal=d.isArray(e.lookup);if(f.isLocal){e.lookup=f.verifySuggestionsFormat(e.lookup);}d(f.suggestionsContainer).css({"max-height":e.maxHeight+"px",width:e.width+"px","z-index":e.zIndex});
},clearCache:function(){this.cachedResponse=[];this.badQueries=[];},clear:function(){this.clearCache();this.currentValue="";this.suggestions=[];},disable:function(){this.disabled=true;
},enable:function(){this.disabled=false;},fixPosition:function(){var e=this,f;if(e.options.appendTo!=="body"){return;}f=e.el.offset();d(e.suggestionsContainer).css({top:(f.top+e.el.outerHeight())+"px",left:f.left+"px"});
},enableKillerFn:function(){var e=this;d(document).on("click.autocomplete",e.killerFn);},disableKillerFn:function(){var e=this;d(document).off("click.autocomplete",e.killerFn);
},killSuggestions:function(){var e=this;e.stopKillSuggestions();e.intervalId=window.setInterval(function(){e.hide();e.stopKillSuggestions();},300);},stopKillSuggestions:function(){window.clearInterval(this.intervalId);
},isCursorAtEnd:function(){var g=this,f=g.el.val().length,h=g.element.selectionStart,e;if(typeof h==="number"){return h===f;}if(document.selection){e=document.selection.createRange();
e.moveStart("character",-f);return f===e.text.length;}return true;},onKeyPress:function(g){var f=this;if(!f.disabled&&!f.visible&&g.which===c.DOWN&&f.currentValue){f.suggest();
return;}if(f.disabled||!f.visible){return;}switch(g.which){case c.ESC:f.el.val(f.currentValue);f.hide();break;case c.RIGHT:if(f.hint&&f.options.onHint&&f.isCursorAtEnd()){f.selectHint();
break;}return;case c.TAB:if(f.hint&&f.options.onHint){f.selectHint();return;}case c.RETURN:if(f.selectedIndex===-1){f.hide();return;}f.select(f.selectedIndex);
if(g.which===c.TAB&&f.options.tabDisabled===false){return;}break;case c.UP:f.moveUp();break;case c.DOWN:f.moveDown();break;default:return;}g.stopImmediatePropagation();
g.preventDefault();},onKeyUp:function(g){var f=this;if(f.disabled){return;}switch(g.which){case c.UP:case c.DOWN:return;}clearInterval(f.onChangeInterval);
if(f.currentValue!==f.el.val()){f.findBestHint();if(f.options.deferRequestBy>0){f.onChangeInterval=setInterval(function(){f.onValueChange();},f.options.deferRequestBy);
}else{f.onValueChange();}}},onValueChange:function(){var e=this,f;if(e.selection){e.selection=null;(e.options.onInvalidateSelection||d.noop)();}clearInterval(e.onChangeInterval);
e.currentValue=e.el.val();f=e.getQuery(e.currentValue);e.selectedIndex=-1;if(f.length<e.options.minChars){e.hide();}else{e.getSuggestions(f);}},getQuery:function(f){var e=this.options.delimiter,g;
if(!e){return d.trim(f);}g=f.split(e);return d.trim(g[g.length-1]);},getSuggestionsLocal:function(h){var g=this,e=h.toLowerCase(),f=g.options.lookupFilter;
return{suggestions:d.grep(g.options.lookup,function(i){return f(i,h,e);})};},getSuggestions:function(h){var e,g=this,f=g.options,i=f.serviceUrl;e=g.isLocal?g.getSuggestionsLocal(h):g.cachedResponse[h];
if(e&&d.isArray(e.suggestions)){g.suggestions=e.suggestions;g.suggest();}else{if(!g.isBadQuery(h)){f.params[f.paramName]=h;if(f.onSearchStart.call(g.element,f.params)===false){return;
}if(d.isFunction(f.serviceUrl)){i=f.serviceUrl.call(g.element,h);}if(this.currentRequest!=null){this.currentRequest.abort();}this.currentRequest=d.ajax({url:i,data:f.ignoreParams?null:f.params,type:f.type,dataType:f.dataType}).done(function(j){g.processResponse(j,h);
f.onSearchComplete.call(g.element,h);});}}},isBadQuery:function(f){var g=this.badQueries,e=g.length;while(e--){if(f.indexOf(g[e])===0){return true;}}return false;
},hide:function(){var e=this;e.visible=false;e.selectedIndex=-1;d(e.suggestionsContainer).hide();e.signalHint(null);},suggest:function(){if(this.suggestions.length===0){this.hide();
return;}var j=this,l=j.options.formatResult,k=j.getQuery(j.currentValue),i=j.classes.suggestion,g=j.classes.selected,e=d(j.suggestionsContainer),f="",h;
d.each(j.suggestions,function(n,m){f+='<div class="'+i+'" data-index="'+n+'">'+l(m,k)+"</div>";});if(j.options.width==="auto"){h=j.el.outerWidth()-2;e.width(h>0?h:300);
}e.html(f).show();j.visible=true;if(j.options.autoSelectFirst){j.selectedIndex=0;e.children().first().addClass(g);}j.findBestHint();},findBestHint:function(){var f=this,g=f.el.val().toLowerCase(),e=null;
if(!g){return;}d.each(f.suggestions,function(j,h){var k=h.value.toLowerCase().indexOf(g)===0;if(k){e=h;}return !k;});f.signalHint(e);},signalHint:function(f){var e="",g=this;
if(f){e=g.currentValue+f.value.substr(g.currentValue.length);}if(g.hintValue!==e){g.hintValue=e;g.hint=f;(this.options.onHint||d.noop)(e);}},verifySuggestionsFormat:function(e){if(e.length&&typeof e[0]==="string"){return d.map(e,function(f){return{value:f,data:null};
});}return e;},processResponse:function(g,f){var i=this,h=i.options,e=h.transformResult(g,f);e.suggestions=i.verifySuggestionsFormat(e.suggestions);if(!h.noCache){i.cachedResponse[e[h.paramName]]=e;
if(e.suggestions.length===0){i.badQueries.push(e[h.paramName]);}}if(f===i.getQuery(i.currentValue)){i.suggestions=e.suggestions;i.suggest();}},activate:function(f){var i=this,j,h=i.classes.selected,e=d(i.suggestionsContainer),g=e.children();
e.children("."+h).removeClass(h);i.selectedIndex=f;if(i.selectedIndex!==-1&&g.length>i.selectedIndex){j=g.get(i.selectedIndex);d(j).addClass(h);return j;
}return null;},selectHint:function(){var f=this,e=d.inArray(f.hint,f.suggestions);f.select(e);},select:function(e){var f=this;f.hide();f.onSelect(e);},moveUp:function(){var e=this;
if(e.selectedIndex===-1){return;}if(e.selectedIndex===0){d(e.suggestionsContainer).children().first().removeClass(e.classes.selected);e.selectedIndex=-1;
e.el.val(e.currentValue);e.findBestHint();return;}e.adjustScroll(e.selectedIndex-1);},moveDown:function(){var e=this;if(e.selectedIndex===(e.suggestions.length-1)){return;
}e.adjustScroll(e.selectedIndex+1);},adjustScroll:function(e){var g=this,k=g.activate(e),f,i,j,h=25;if(!k){return;}f=k.offsetTop;i=d(g.suggestionsContainer).scrollTop();
j=i+g.options.maxHeight-h;if(f<i){d(g.suggestionsContainer).scrollTop(f);}else{if(f>j){d(g.suggestionsContainer).scrollTop(f-g.options.maxHeight+h);}}g.el.val(g.getValue(g.suggestions[e].value));
g.signalHint(null);},onSelect:function(f){var h=this,g=h.options.onSelect,e=h.suggestions[f];h.currentValue=h.getValue(e.value);h.el.val(h.currentValue);
h.signalHint(null);h.suggestions=[];h.selection=e;if(d.isFunction(g)){g.call(h.element,e);}},getValue:function(h){var g=this,e=g.options.delimiter,f,i;
if(!e){return h;}f=g.currentValue;i=f.split(e);if(i.length===1){return h;}return f.substr(0,f.length-i[i.length-1].length)+h;},dispose:function(){var e=this;
e.el.off(".autocomplete").removeData("autocomplete");e.disableKillerFn();d(window).off("resize",e.fixPositionCapture);d(e.suggestionsContainer).remove();
}};d.fn.autocomplete=function(f,e){var g="autocomplete";if(arguments.length===0){return this.first().data(g);}return this.each(function(){var i=d(this),h=i.data(g);
if(typeof f==="string"){if(h&&typeof h[f]==="function"){h[f](e);}}else{if(h&&h.dispose){h.dispose();}h=new b(this,f);i.data(g,h);}});};}));